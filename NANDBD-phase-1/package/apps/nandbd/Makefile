
CC = $(CROSS_COMPILE)gcc
STRIP = $(CROSS_COMPILE)strip
LD = $(CC)

PROG = nandbd
SCRIPTS = $(shell ls *.sh)

OBJS := $(patsubst %.c,%.o,$(wildcard *.c))

ifdef SDK_BUILD_NAND_STAGE1_BLOCK
PARTMAP += -DSDK_BUILD_NAND_STAGE1_BLOCK=$(SDK_BUILD_NAND_STAGE1_BLOCK)
endif
ifdef SDK_BUILD_NAND_STAGE1_BLOCK2
PARTMAP += -DSDK_BUILD_NAND_STAGE1_BLOCK2=$(SDK_BUILD_NAND_STAGE1_BLOCK2)
endif
ifdef SDK_BUILD_NAND_STAGE2_BLOCK
PARTMAP += -DSDK_BUILD_NAND_STAGE2_BLOCK=$(SDK_BUILD_NAND_STAGE2_BLOCK)
endif
ifdef SDK_BUILD_NAND_STAGE2_BLOCK2
PARTMAP += -DSDK_BUILD_NAND_STAGE2_BLOCK2=$(SDK_BUILD_NAND_STAGE2_BLOCK2)
endif
ifdef SDK_BUILD_NAND_KERNEL_BLOCK
PARTMAP += -DSDK_BUILD_NAND_KERNEL_BLOCK=$(SDK_BUILD_NAND_KERNEL_BLOCK)
endif
ifdef SDK_BUILD_NAND_KERNEL_BLOCK2
PARTMAP += -DSDK_BUILD_NAND_KERNEL_BLOCK2=$(SDK_BUILD_NAND_KERNEL_BLOCK2)
endif

all: $(PROG)

$(PROG): $(OBJS)
	$(CC) $(LDFLAGS) $(OBJS) -o $(PROG)
	$(STRIP) $(PROG)

$(OBJS): %.o: %.c
	$(CC) -Wall $(CFLAGS) $(PARTMAP) -c $*.c -o $*.o

clean:
	@rm -f $(OBJS) $(PROG)

